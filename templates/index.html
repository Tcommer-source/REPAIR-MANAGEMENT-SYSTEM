<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8">
    <title>üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* ‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Dashboard ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á */
        body { 
            background: radial-gradient(circle at top left, #e0e5ec, #f0f2f5); 
            color: #444; 
            font-family: 'Sarabun', sans-serif; 
            min-height: 100vh;
        }

        /* Nav Bar ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Dashboard */
        .nav-bar { 
            background: linear-gradient(145deg, #1a2a6c, #142152); 
            color: white; 
            padding: 15px; 
            margin-bottom: 30px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        /* Card ‡∏ô‡∏π‡∏ô‡∏™‡πÑ‡∏ï‡∏•‡πå 3D Neumorphism */
        .main-card { 
            background: rgba(255, 255, 255, 0.9); 
            border-radius: 20px; 
            padding: 25px; 
            box-shadow: 20px 20px 60px #d1d9e6, -20px -20px 60px #ffffff; 
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ï‡∏≤ */
        .table { border-radius: 15px; overflow: hidden; }
        .table thead { background: #1a2a6c; color: white; border: none; }
        .table-hover tbody tr:hover { background-color: rgba(26, 42, 108, 0.05); }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏°‡∏¥‡∏ï‡∏¥ 3D */
        .btn-3d { 
            border-radius: 50px; 
            padding: 8px 20px; 
            font-weight: bold; 
            transition: all 0.3s; 
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .btn-3d:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .btn-3d:active { transform: translateY(1px); }

        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Badge ‡πÅ‡∏ö‡∏ö‡∏ô‡∏π‡∏ô */
        .badge-status { 
            padding: 8px 15px; 
            border-radius: 50px; 
            font-size: 0.85rem; 
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1);
        }

        .modal-content { border-radius: 20px; border: none; box-shadow: 0 25px 50px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div class="nav-bar">
    <div class="container d-flex justify-content-between align-items-center">
        <h4 class="m-0"><i class="fas fa-tools me-2"></i>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</h4>
        <div class="d-flex align-items-center">
            {% if current_user %}
            <span class="me-3 small"><i class="fas fa-user-circle me-1"></i> {{ current_user }}</span>
            {% endif %}
            <a href="/logout" class="btn btn-danger btn-sm rounded-pill px-3 shadow-sm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
    </div>
</div>

<div class="container py-2">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-secondary"><i class="fas fa-list-ul me-2"></i>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h2>
        <div>
            <a href="/add" class="btn btn-success btn-3d me-2"><i class="fas fa-plus-circle me-1"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</a> 
            <a href="/dashboard" class="btn btn-info btn-3d text-white"><i class="fas fa-chart-pie me-1"></i> ‡∏î‡∏π Dashboard</a>
        </div>
    </div>

    <div class="main-card">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th class="ps-3">ID</th>
                        <th>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á / ‡πÅ‡∏ú‡∏ô‡∏Å</th>
                        <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                        <th style="width: 25%;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á</th>
                        <th class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="text-center">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    {% for job in jobs %}
                    <tr>
                        <td class="ps-3 fw-bold text-muted">#{{ job.id }}</td>
                        <td>
                            <div class="fw-bold text-primary">{{ job.user }}</div>
                            <small class="text-muted">{{ job.department }}</small>
                        </td>
                        <td><span class="text-secondary small fw-bold">{{ job.category }}</span></td>
                        <td>
                            <div class="text-truncate" style="max-width: 250px;">{{ job.detail }}</div>
                            {% if job.progress_note %}
                            <div class="small text-info mt-1"><i class="fas fa-sticky-note me-1"></i>{{ job.progress_note }}</div>
                            {% endif %}
                        </td>
                        <td class="small">{{ job.created_at.strftime('%d/%m/%Y %H:%M') if job.created_at else '-' }}</td>
                        <td class="text-center">
                            {% if job.status == 'Open' %}
                                <span class="badge badge-status bg-warning text-dark">‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡πà‡∏≠‡∏°</span>
                            {% elif job.status == 'In Progress' %}
                                <span class="badge badge-status bg-info text-white">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                            {% else %}
                                <span class="badge badge-status bg-success text-white">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            {% if job.status == 'Open' %}
                                <button class="btn btn-outline-warning btn-sm btn-3d" data-bs-toggle="modal" data-bs-target="#progressModal" data-id="{{ job.id }}">
                                    <i class="fas fa-wrench me-1"></i> ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
                                </button>
                            {% elif job.status == 'In Progress' %}
                                <a href="/update_status/{{ job.id }}/Done" class="btn btn-success btn-sm btn-3d">
                                    <i class="fas fa-check-circle me-1"></i> ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô
                                </a>
                            {% else %}
                                <span class="text-muted small"><i class="fas fa-check-double me-1"></i>‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="progressModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <form id="progressForm" method="POST">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title fw-bold"><i class="fas fa-edit me-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <label class="form-label fw-bold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</label>
                    <textarea name="progress_note" class="form-control shadow-sm" rows="4" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏Ç‡∏≤‡∏î ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö..."></textarea>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn btn-warning btn-3d px-4">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    const modal = document.getElementById('progressModal')
    modal.addEventListener('show.bs.modal', e => {
        document.getElementById('progressForm').action = `/update_progress/${e.relatedTarget.getAttribute('data-id')}`
    })
</script>
</body>
</html>
